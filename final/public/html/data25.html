<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../css/styles.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.7.0/nv.d3.min.css"
      rel="stylesheet"
    />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.7.0/nv.d3.min.js"></script>
  </head>
  <body>
    <nav id="navBar" class="navBar withNavBarOneEdgeShadow">
      <div class="navBarOverallContainer">
        <a class="navBarSiteLogo tabHighlightable" href="/" tabindex="0">
          <span class="insideTabHighlightable insideButText" tabindex="-1">
            Startup Analysis
          </span>
        </a>

        <div class="navbar_routes">
          <ul class="nav navbar-nav mx-auto">
            <a class="btn btn-light navbar-btn" href="./data">Data</a>
            <a class="btn btn-light navbar-btn" href="./creds">Creds</a>
          </ul>
        </div>
      </div>
    </nav>
    <br /><br /><br />

    <h1>U.S. Map of Startups</h1>

    <nav class="navbar navbar-expand-md navbar-inverse">
      <div class="container-fluid">
        <ul class="nav navbar-nav mx-auto">
          <a
            style="text-decoration: none"
            class="btn btn-light navbar-btn"
            href="./data2"
            >&lt;</a
          >
          <a
            style="text-decoration: none"
            class="btn btn-light navbar-btn"
            href="./data3"
            >&gt;</a
          >
        </ul>
      </div>
    </nav>
    <p class="description">
      Looking at forecasts of startup companies using machine learning is a
      relevant yet largely untouched field. Currently, venture capital firms use
      intuition, financial projections, and personal connections to determine
      which companies receive seed money. Understandably, there is high risk and
      uncertainty associated with venture capital where only a handful of
      companies become unicorns (> $1bn valuation) with successful exits. The
      goal of this machine learning project is to shed some light into what
      variables contribute to a companyâ€™s success, outside of financials, to
      reduce the randomness and personal bias in venture capital investment.
    </p>

    <!-- Load d3.js and the geo projection plugin -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

    <div>
      <input type="checkbox" class="checkbox" value="A" checked /><label
        >group A</label
      >
      <input type="checkbox" class="checkbox" value="B" checked /><label
        >group B</label
      >
      <input type="checkbox" class="checkbox" value="C" checked /><label
        >group C</label
      >
    </div>

    <!-- Create an element where the map will take place -->
    <svg id="my_dataviz" width="440" height="300"></svg>

    <script>
      // The svg
      var svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

      // Map and projection
      var projection = d3
        .geoMercator()
        .center([2, 47]) // GPS of location to zoom on
        .scale(1020) // This is like the zoom
        .translate([width / 2, height / 2]);

      // Create data for circles:
      var markers = [
        { long: 9.083, lat: 42.149, group: "A", size: 34 }, // corsica
        { long: 7.26, lat: 43.71, group: "A", size: 14 }, // nice
        { long: 2.349, lat: 48.864, group: "B", size: 87 }, // Paris
        { long: -1.397, lat: 43.664, group: "B", size: 41 }, // Hossegor
        { long: 3.075, lat: 50.64, group: "C", size: 78 }, // Lille
        { long: -3.83, lat: 48, group: "C", size: 12 }, // Morlaix
      ];

      // Load external data and boot
      d3.json(
        "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson",
        function (data) {
          // Filter data
          data.features = data.features.filter(function (d) {
            return d.properties.name == "France";
          });

          // Create a color scale
          var color = d3
            .scaleOrdinal()
            .domain(["A", "B", "C"])
            .range(["#402D54", "#D18975", "#8FD175"]);

          // Add a scale for bubble size
          var size = d3
            .scaleLinear()
            .domain([1, 100]) // What's in the data
            .range([4, 50]); // Size in pixel

          // Draw the map
          svg
            .append("g")
            .selectAll("path")
            .data(data.features)
            .enter()
            .append("path")
            .attr("fill", "#b8b8b8")
            .attr("d", d3.geoPath().projection(projection))
            .style("stroke", "black")
            .style("opacity", 0.3);

          // Add circles:
          svg
            .selectAll("myCircles")
            .data(markers)
            .enter()
            .append("circle")
            .attr("class", function (d) {
              return d.group;
            })
            .attr("cx", function (d) {
              return projection([d.long, d.lat])[0];
            })
            .attr("cy", function (d) {
              return projection([d.long, d.lat])[1];
            })
            .attr("r", function (d) {
              return size(d.size);
            })
            .style("fill", function (d) {
              return color(d.group);
            })
            .attr("stroke", function (d) {
              return color(d.group);
            })
            .attr("stroke-width", 3)
            .attr("fill-opacity", 0.4);

          // This function is gonna change the opacity and size of selected and unselected circles
          function update() {
            // For each check box:
            d3.selectAll(".checkbox").each(function (d) {
              cb = d3.select(this);
              grp = cb.property("value");

              // If the box is check, I show the group
              if (cb.property("checked")) {
                svg
                  .selectAll("." + grp)
                  .transition()
                  .duration(1000)
                  .style("opacity", 1)
                  .attr("r", function (d) {
                    return size(d.size);
                  });

                // Otherwise I hide it
              } else {
                svg
                  .selectAll("." + grp)
                  .transition()
                  .duration(1000)
                  .style("opacity", 0)
                  .attr("r", 0);
              }
            });
          }

          // When a button change, I run the update function
          d3.selectAll(".checkbox").on("change", update);

          // And I initialize it at the beginning
          update();
        }
      );
    </script>
  </body>
</html>
